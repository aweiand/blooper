#!/usr/bin/env ruby

# $VERBOSE = true
require 'pg'
require 'active_record'
require_relative '../lib/blooper'

Blooper.connect_db

Blooper::Input.new(STDIN).each do |rows|
  begin
    rows.save
  rescue ActiveRecord::StatementInvalid
    Blooper.reconnect_db!
    retry
  end
end
